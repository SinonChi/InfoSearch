однажд  в  очередн  раз  возникл  задач  о  закачк  относительн  больш  файл  говор  конкретн  клиент  захотел  залива  на  сайт  через  админк  видеоролик  размер  20-40  мегабайт  каза  бы  в  наш  просвещен  врем  подобн  размер    эт  так  мелоч  о  ко  и  говор  стыдн  но  внезапн  все  уперл  в  настройк  виртуальн  хостинг  мы  с  ужас  обнаруж  что  максимальн  размер  закачива  файл    2m  и  поменя  эт  цифр  нет  возможн  и  меня  хостинг  по  ряд  причин  нельз    по  крайн  мер  не  сейчас  перед  нам  встает  задач    обойт  ограничен  убог  виртуальн  хостинг  сам  принцип  так  обход  очевид  файл  над  пореза  на  куск  зал  част  а  на  сторон  сервер  собра  в  един  цел  но  дела  эт  над  не  вручн    пользовател  долж  выбра  файл  и  нажа  на  кнопк  отправ  как  же  эт  сдела  сам  перв  наш  реакц    посмотрет  возможн  различн  флеш-аплоадер  вед  не  может  быт  чтоб  миров  техническ  мысл  не  реализова  так  полезн  вещ  как  загрузк  файл  по  част  перебира  последовательн  uploadify  swfupload  fancyupload  jquploader  jquery-transmit  но  все  тщетн  иском  фич  мы  не  вид  вполн  вероятн  что  над  копа  дальш  но  врем  поджима  и  над  уж  что-т  дела  вышеописа  печальн  однак  нам  на  рук  игра  тот  факт  что  эт  админк  те  нам  вовс  не  нужн  ориентирова  на  кроссбраузерн  достаточн  тог  что  этот  механизм  будет  работа  на  браузер  клиент  каков  о  чуд  явля  ff  тут  же  вспомина  что  в  ff  последн  верс  ест  возможн  получ  в  строк  содержим  файл  загружен  в  пол  file-upload  и  в  голов  приход  желан  разбива  эт  строк  на  куск  и  закачива  част  использу  ajax  клиентск  част  снача  нарису  необходим  в  статическ  html  form    input  typefile  idmyfileforma  href#  onclickbig_file_upload'#myfile'отправитьa  те  при  нажат  на  ссылк  должн  быт  вызва  функц  big_file_upload  в  котор  переда  объект  из  котор  нужн  взят  содержим  файл  обрат  вниман  на  конструку  '#myfile'  дума  нет  нужд  подробн  останавлива  на  необходим  подключен  библиотек  jquery  котор  мы  такж  буд  использова  и  для  ajax-запрос  при  передач  файл  на  сервер  тепер  нам  над  написа  ту  сам  функц  big_file_upload  var  upload_chunk_size    120000  в  эт  перемен  леж  размер  куск  на  котор  мы  буд  дел  файл  function  big_file_uploadfile  {      }  получен  содержим  файл  для  получен  содержим  файл  буд  использова  след  конструкц      var  data    fileget0filesitem0getasdataurl  поясня  е  смысл  fileget0    получен  dom-объект  из  jquery-объект  переда  в  функц  filesitem0    получен  перв  файл  из  списк  зде  он  у  нас  единствен  однак  напомн  что  уж  ест  возможн  множествен  закачк  файл  из  одн  контрол  getasdataurl    получен  содержим  файл  в  формат  dataurl  ест  ещ  метод  getastext  и  getasbinary  однак  нам  нужн  передава  на  сервер  метод  post  поэт  желательн  получ  содержим  файл  закодирова  в  base64  аналогичн  конструкц  получа  им  файл      var  filename    fileget0filesitem0filename  поскольк  содержим  у  нас  в  формат  dataurl  то  неплох  был  бы  отреза  заголовочн  част  в  котор  наход  информац  о  mime-тип  и  способ  кодирован  в  бол  общ  вариант  наш  функц  эт  информац  над  бы  использова  но  в  дан  пример  он  нам  тольк  будет  меша  при  декодирован  поэт  прост  отреж  все  по  перв  запят  включительн  котор  отделя  заголовок      var  comma    dataindexof''    if  comma0  data    datasubstringcomma+1  отправк  файл  куск  зде  все  банальн    var  pos    0    while  posdatalength  {          post'uploadphp'{            filenamefilename            chunkdatasubstringpospos+upload_chunk_size        }          pos  +  upload_chunk_size    }  серверн  част  тепер  сдела  на  сервер  принима  php-скрипт  uploadphp  в  вариант  для  пример  он  такж  предельн  прост      filename    _post'filename'    f    fopendirtosavefilenamea    fputsfbase64_decode_post'chunk'    fclosef  файл  открыва  с  опц  а  те  предлага  не  перезаписыва  существ  файл  а  дополня  ег  так  способ  мы  из  куск  собер  цел  файл  дума  всем  понятн  что  дан  скрипт  долж  лежа  в  закрыт  админск  част  сайт  чтоб  к  нем  не  имел  доступ  разн  личност  со  сторон  кром  тог  им  файл  и  сам  файл  должн  проверя  на  валидн  инач    эт  даж  не  уязвим  а  я  и  слова-т  так  не  зна  пробу  запуст  попробова  получ  держ  пар  что  получ  совс  не  то  что  ожида  файл  врод  бы  закача  врод  бы  даж  длин  правильн  а  вот  содержим    какая-т  каш  поч  так  получ  ответ  прост  post-запрос  отправля  в  асинхрон  режим  по  нескольк  куск  одновремен  поэт  никт  не  гарантир  что  на  сервер  он  будут  приход  имен  в  то  последовательн  в  котор  был  пода  команд  на  отправк  мал  тог  что  никт  не  гарантир  а  я  прямо-так  утвержда  что  никогд  он  не  придут  в  нужн  последовательн  всегд  будет  получа  каш  поэт  как  эт  ни  грустн  придет  асинхрон  отключ  перед  оправк  файл  выполн  след    ajaxsetup{asyncfalse}  тепер  все  нормальн  файл  собира  в  нужн  последовательн  однак  на  врем  закачк  исполнен  проч  скрипт  приостанавлива  поэт  чтоб  не  нервирова  пользовател  был  бы  неплох  где-нибуд  показыва  процентик  ил  прогресс-бар  так  образ  работоспособн  скрипт  выгляд  след  образ  var  upload_chunk_size    120000    размер  куск  function  big_file_uploadfile  {    var  data    fileget0filesitem0getasdataurl    получа  содержим  файл    var  filename    fileget0filesitem0filename    получа  им  файл      var  comma    dataindexof''      if  comma0  data    datasubstringcomma+1    отреза  заголовок  dataurl      var  pos    0    ajaxsetup{asyncfalse}    отключа  асинхрон      while  posdatalength  {          post'uploadphp'{    отправля  post            filenamefilename    им  файл            chunkdatasubstringpospos+upload_chunk_size    кусок  файлв        }          pos  +  upload_chunk_size          var  p    mathroundpos100datalength    вычисля  процент  отправлен        '#progress'textp+''    рису  цифир  для  спокойств  пользовател    }}  недостатк  как  же  без  них  в  дан  пример  предполага  что  метод  getasdataurl  всегд  возвраща  дан  закодирова  в  base64  на  сам  дел  я  бы  не  стал  бит  об  заклад  что  так  будет  всегд  по-хорош  заголовок  над  не  выкидыва  а  передава  серверн  част  котор  в  сво  очеред  науч  обрабатыва  дан  закодирова  разн  способ  файл  отправлен  два  раз  запишет  на  сервер  два  раз  прич  дополн  сам  себ  чтоб  избежа  эт  видим  нужн  передава  кром  имен  ещ  и  какой-т  уникальн  идентификатор  закачк  но  эт  вообщ  говор  вопрос  способ  формирован  и  передач  имен  файл  зде  универсальн  рецепт  нет  и  быт  не  может  клиентск  скрипт  исполня  долг  в  зависим  от  размер  файл  и  толщин  кана  и  ff  может  даж  поинтересова  вы  мол  увер  ли  что  над  ждат  окончан  ил  уб  ег  чтоб  не  муча  кроссбраузерн  получен  содержим  файл  ув  работа  тольк  на  ff  провер  на  30  35  и  36  на  бол  ран  не  проверя  за  неимен  таков  под  рук  сам  разработчик  ff  рекоменд  вмест  эт  способ  пользова  fileapi  однак  он  появ  тольк  в  36  действительн  больш  файл  сотн  мегабайт  гигабайт  закача  так  способ  не  получ  предел  завис  от  объем  памят  доступн  браузер  что  сдела  вероятн  над  попробова  все-так  в  асинхрон  режим  для  кажд  куск  передава  ещ  и  информац  о  ег  расположен  внутр  файл  при  эт  серверн  част  серьезн  усложн  